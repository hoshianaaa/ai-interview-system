generator client {
  provider = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

enum InterviewStatus {
  created
  used
  recording
  ending
  completed
  failed
}

enum InterviewOutcome {
  pass
  fail
  hold
}

enum NotificationStatus {
  not_sent
  sent
}

enum ChatRole {
  interviewer
  candidate
}

model Interview {
  interviewId       String          @id
  publicToken       String?         @unique
  orgId             String?
  roomName          String          @unique
  status            InterviewStatus @default(created)
  outcome           InterviewOutcome @default(hold)
  notificationStatus NotificationStatus @default(not_sent)
  notifiedAt        DateTime?
  durationSec       Int

  candidateIdentity String
  candidateName     String?
  agentName         String

  dispatchId        String?
  egressId          String?

  r2Bucket          String
  r2ObjectKey       String?
  recordingStartedAt DateTime?
  interviewNotes    String?         @db.Text

  createdAt         DateTime        @default(now())
  usedAt            DateTime?
  candidateJoinedAt DateTime?
  endedAt           DateTime?
  error             String?

  messages          InterviewMessage[]

  @@index([orgId])
}

model InterviewMessage {
  messageId   String    @id
  interviewId String
  orgId       String?
  role        ChatRole
  text        String
  offsetMs    Int
  createdAt   DateTime  @default(now())

  interview   Interview @relation(fields: [interviewId], references: [interviewId], onDelete: Cascade)

  @@index([interviewId])
  @@index([orgId])
  @@index([interviewId, offsetMs])
}
